<!DOCTYPE html>
<html>

<head>
    <!-- <script src="https://cdn.cloudinary.com/sdk/js/cloudinary-core-shrinkwrap.min.js"></script> -->
</head>

<body>

    <button id="upload_widget" class="cloudinary-button">Upload files</button>
    

    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>

    <script type="text/javascript">
        function sendFile() {
            let url = 'http://res.cloudinary.com/dvvzlzude/image/upload/v1674403599/vahqiec6wsewybkclx3z.pdf';
            const request = new XMLHttpRequest()
            request.open("POST", `/ProcessDoc/${JSON.stringify(url)}`)
            request.send();

        }
        var myWidget = cloudinary.createUploadWidget({
            cloudName: 'dvvzlzude',
            uploadPreset: 'espotpxe'
        }, (error, result) => {
            if (!error && result && result.event === "success") {
                console.log('Done! Here is the image info: ', result.info);
                let url = String(result.info.url);
                let public_id=String(result.info.public_id)
                console.log(public_id);

                (async () => {
                    const rawResponse = await fetch('/ProcessDoc', {
                        method: 'POST',
                        headers: {
                            'Accept': 'application/json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ 'URL':result.info.url,"public_id":public_id})
                    });
                    const content = await rawResponse.json();

                    console.log(content);
                })();
                // const request=new XMLHttpRequest()
                // request.open("POST",`/ProcessDoc/${JSON.stringify(url)}` )
                // request.send();
            } else {
                console.log("err", error)


            }
        }
        )

        document.getElementById("upload_widget").addEventListener("click", function () {
            myWidget.open();
        }, false);
    </script>

</body>

</html>